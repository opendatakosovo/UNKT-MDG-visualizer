<!DOCTYPE html>
<html>
<head>
    <title>Kosovo Mosaic</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" integrity="sha384-aUGj/X2zp5rLCbBxumKTCw2Z50WgIr1vs/PFN4praOTvYXWlVyh2UtNUU0KAUhAX" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>

    <!-- D3 charts -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
	<link rel="stylesheet" type="text/css" href="static/css/style.css">
	<link rel="stylesheet" type="text/css" href="static/css/radio-button.css">

    <!-- jquery plugin -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="data/output2015.js"></script>


    <!-- Highcharts map JavaScript -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/maps/modules/map.js"></script>
    <script src="https://code.highcharts.com/maps/modules/data.js"></script>
    <script src="static/highcharts/kv-all.js"></script>

    <style type="text/css">
        #container {
            height: 500px; 
            min-width: 310px; 
            max-width: 800px; 
            margin: 0 auto; 
        }
        .loading {
            margin-top: 10em;
            text-align: center;
            color: gray;
        }

    </style>

    <script type="text/javascript">
    	function slugify(text) {
		  return text.toString().toLowerCase()
		    .replace(/\s+/g, '-')           // Replace spaces with -
		    .replace(/[^\w\-]+/g, '')       // Remove all non-word chars
		    .replace(/\-\-+/g, '-')         // Replace multiple - with single -
		    .replace(/^-+/, '')             // Trim - from start of text
		    .replace(/-+$/, '');            // Trim - from end of text
		}

    	municipality_names_to_fix = {
    		"Gliogovc": "Drenas"
    	}

        function drawMap(year, indicator){
        	$.ajax({
				'url': "http://assemblio.github.io/kosovo-mosaic-visualizer/data/output" + year + ".json",
				'dataType': 'json',
				'responseJSON': 'data',
				'success': function (data) {
					var municipalities_data = []
					for (key in data){
						var name = key
						if (key == "Gliogovc"){
							name = "Drenas";
						} else if (key == "Mitrovica South") {
							name = "Mitrovice"
						} else if (key == "Mitrovica North") {
							name = "Mitrovice Veriore"
						} else if (key == "Novoberda") {
							name = "Novo berd"
						} else if (key == "Mitrovica") {
							name = "Mitrovice"
						}
						if (data[key][indicator] != null){
							var json_key = {
								"hc-key": "kv-" + slugify(name),
								"value": data[key][indicator]
							}
							municipalities_data.push(json_key);
						}
					}

		            // Initiate the chart
		            $('#container').highcharts('Map', {
		                title : {
		                    text : ''
		                },

		                mapNavigation: {
		                    enabled: true,
		                    buttonOptions: {
		                        verticalAlign: 'bottom'
		                    }
		                },

		                colorAxis: {
		                    min: 0,
		                    maxColor: '#73AD21'
		                },

		                tooltip: {
				            backgroundColor: '#FCFFC5',
				            fontSize: "15px",
				            valueSuffix: "%"
				        },

		                series : [{
		                    data : municipalities_data,
		                    mapData: Highcharts.maps['countries/kv/kv-all'],
		                    joinBy: 'hc-key',
		                    name: indicator,
		                    states: {
		                        hover: {
		                            color: 'grey'
		                        }
		                    },
		                    dataLabels: {
		                        enabled: true,
		                        format: '{point.name}'
		                    }
		                }]
		            });
		        }
			});
		}	

        // function drawBarChart(div, chart_type){
        //     var obj = {
        //         "Satisfaction with family medical centers":47.8,
        //         "Satisfaction with hospitals":45.8,
        //         "Satisfaction with public health":56.0,
        //         "Satisfaction with access to and quality of preschool education":76.8,
        //         "Satisfaction with primary and secondary schools/education":73.8,
        //         "Satisfaction with waste collection services":55.9,
        //         "Satisfaction with water supply":60.2,
        //         "Satisfaction with sewage and sanitation":54.4,
        //         "Satisfaction with local road maintenance":56.8,
        //         "Satisfaction with maintenance of inter-municipal roads and highways":61.0,
        //         "Satisfaction with traffic and parking control and regulation":41.2,
        //         "Satisfaction with electricity supply":71.5,
        //         "Satisfaction with phone and postal services":73.6,
        //         "Satisfaction with environmental protection":46.6,
        //         "Satisfaction with nature and species conservation":46.4,
        //         "Satisfaction with cultural activities":47.7,
        //         "Satisfaction with sports activities":52.2,
        //         "Satisfaction with youth activities":46.6,
        //         "Satisfaction with emergency services":73.5,
        //         "Satisfaction with urban and rural planning":37.0,
        //         "Satisfaction with social services":34.9,
        //         "Satisfaction with procedures for tax payment":61.1,
        //         "Satisfaction with public transport":55.9,
        //         "Satisfaction with protection of cultural heritage":44.5,
        //         "Satisfaction with public procurement/tenders":24.3,
        //         "Satisfaction with recruitment of local staff":24.7,
        //         "Satisfaction with management of municipal funds":31.9,
        //         "Satisfaction with public lighting":53.9,
        //         "Satisfaction with sidewalks":52.4,
        //         "Satisfaction with municipal parks and squares": 61.9,
        //         "Satisfaction with Kosovo Police":70.7,
        //         "Satisfaction with cemetery maintenace":51.5,
        //         "Satisfaction with the Mayor":54.1,
        //         "Satisfaction with Municipal Assembly":49.2,
        //         "Satisfaction with Municipal Administration":61.4
        //     };

        //     var array=[]
        //     for(a in obj){
        //         array.push([a,obj[a]])
        //     }
        //     array.sort(function(a,b){return a[1] - b[1]});
        //     sorted_array = array.reverse();

        //     var json_data = {}
        //     var categories = []
        //     var data = []

        //     for(var a=0,b,txt='';b=array[a];++a){
        //         json_data[b[0]] = b[1];
        //         categories.push(b[0]);
        //         data.push(b[1]);
        //     }

        //     $('#' + div).highcharts({
        //         chart: {
        //             type: chart_type
        //         },
        //         title: {
        //             text: 'Historic World Population by Region'
        //         },
        //         subtitle: {
        //             text: 'Source: <a href="https://en.wikipedia.org/wiki/World_population">Wikipedia.org</a>'
        //         },
        //         xAxis: {
        //             categories: categories,
        //             title: {
        //                 text: null
        //             }
        //         },
        //         yAxis: {
        //             min: 0,
        //             title: {
        //                 text: 'Population (millions)',
        //                 align: 'high'
        //             },
        //             labels: {
        //                 overflow: 'justify'
        //             }
        //         },
        //         tooltip: {
        //             valueSuffix: ' millions'
        //         },
        //         plotOptions: {
        //             bar: {
        //                 colorByPoint: true,
        //                 dataLabels: {
        //                     enabled: true
        //                 }
        //             }
        //         },
        //         legend: {
        //             borderWidth: 1,
        //             shadow: true
        //         },
        //         credits: {
        //             enabled: false
        //         },
        //         series: [{
        //             name: 'Year 1800',
        //             data: data
        //         }]
        //     });
        // }

        function drawColumnChart(div, chart_type, year, indicator){
        	$.ajax({
				'url': "http://assemblio.github.io/kosovo-mosaic-visualizer/data/output" + year + ".json",
				'dataType': 'json',
				'responseJSON': 'data',
				'success': function (data) {
					console.log(data)
					var json_obj = {}
					for (key in data){
						if (data[key][indicator] != null) {
							json_obj[key] = data[key][indicator]
						}
					}

		            var array=[]
		            for(a in json_obj){
		                array.push([a,json_obj[a]])
		            }
		            array.sort(function(a,b){return a[1] - b[1]});
		            sorted_array = array.reverse();

		            var json_data = {}
		            var categories = []
		            var data = []

		            for(var a=0,b,txt='';b=array[a];++a){
		                json_data[b[0]] = b[1];
		                categories.push(b[0]);
		                data.push(b[1]);
		            }

					console.log(json_data)
		            $('#' + div).highcharts({
		                chart: {
		                    type: chart_type
		                },
		                title: {
		                    text: 'Historic World Population by Region'
		                },
		                subtitle: {
		                    text: 'Source: <a href="https://en.wikipedia.org/wiki/World_population">Wikipedia.org</a>'
		                },
		                xAxis: {
		                    categories: categories,
		                    title: {
		                        text: null
		                    }
		                },
		                yAxis: {
		                    min: 0,
		                    title: {
		                        text: 'Population (millions)',
		                        align: 'high'
		                    },
		                    labels: {
		                        overflow: 'justify'
		                    }
		                },
		                tooltip: {
		                    valueSuffix: ' %'
		                },
		                plotOptions: {
		                    column: {
		                        colorByPoint: true,
		                        dataLabels: {
		                            enabled: true
		                        }
		                    }
		                },
		                legend: {
		                    borderWidth: 1,
		                    shadow: true
		                },
		                credits: {
		                    enabled: false
		                },
		                series: [{
		                    name: 'Year 1800',
		                    data: data
		                }]
		            });
				}
			});
        }

        function bindIndicatorSelectBox(year){
			$.ajax({
				'url': "http://assemblio.github.io/kosovo-mosaic-visualizer/data/output" + year + ".json",
				'dataType': 'json',
				'responseJSON': 'data',
				'success': function (data) {
        			$("#indicator-select").empty();
					for (key in data["Pristina"]){
						$("#indicator-select").append("<option value='"+key+"'>"+key+"</option>");
					}
				}
			});
		}

        $(document).ready(function(){
            var json_obj = jsonObject()
            var muni = "Kosovo";
			start('2015', muni);
			bindIndicatorSelectBox("2015")

			$("input[name=radio]:radio").change(function () {
				var year = $('input[name=radio]:checked', '#my-form').val()
				start(year, muni);
	        	bindIndicatorSelectBox(year);
				var indicator = $("#indicator-select").val();
            	drawMap(year, indicator);
            	drawColumnChart("column-chart", "column", year, indicator);
			});

			$("#indicator-select").change(function(){
				var indicator = $("#indicator-select").val();
				var year = $('input[name=radio]:checked', '#my-form').val()
            	drawMap(year, indicator);
            	drawColumnChart("column-chart", "column", year, indicator);
			})

            drawMap("2015", "Satisfaction with family medical centers");
            // drawBarChart("bar-chart", "bar");
            drawColumnChart("column-chart", "column", "2015", "Satisfaction with family medical centers");
        })
    </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row" style="margin-top: 10px;">
        	<form id="my-form">
	            <div class="col-md-2">
	            </div>
	            <div class="col-md-3">
	                <select id="indicator-select" class="form-control">
	                </select>
	                <br>
	            </div>
	            <div class="col-md-1">
		            <input type="radio" name="radio" id="2015" value="2015" class="radio" checked/>
					<label for="2015">2015</label>
	            </div>
	            <div class="col-md-1">
	                <input type="radio" name="radio" id="2012" value="2012" class="radio"/>
					<label for="2012">2012</label>
	            </div>
	            <div class="col-md-1">
	            	<input type="radio" name="radio" id="2009" value="2009" class="radio"/>
					<label for="2009">2009</label>
	            </div>
	            <div class="col-md-1">
	            	<input type="radio" name="radio" id="2006" value="2006" class="radio"/>
					<label for="2006">2006</label>
	            </div>
	            <div class="col-md-1">
	            	<input type="radio" name="radio" id="2003" value="2003" class="radio"/>
					<label for="2003">2003</label>
	            </div>
	            <div class="col-md-2">
	            </div>
	        </form>
        </div>
        <br>
        <div class="row">
            <div class="col-md-8">
                <div id="container" style="height:550px;"></div>
            </div>
            <div class="col-md-4" style="height:550px;">
                	<br>
                	<br>
                	<br>
                <div id="aster-chart">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div id="column-chart" style="height:400px;"></div>
            </div>
        </div>
    </div>
    
    <!-- Aster chart script -->
    <script src="static/js/draw.js" ></script>
</body>
</html>